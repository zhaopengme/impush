/*! For license information please see Hotflow.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Hotflow",[],t):"object"==typeof exports?exports.Hotflow=t():e.Hotflow=t()}("undefined"!=typeof self?self:this,(function(){return(()=>{"use strict";var e={70:(e,t,n)=>{n.d(t,{default:()=>B});for(var o=function(){},r="Content-Type",i="application/json",s="multipart/form-data",a=Object.create(null),c=function(){var e=h[u];a[e]=function(t){var n=t.url,a=t.params,c=t.before,u=t.after,h=t.success,l=t.error,f=t.headers,d=t.timeout,g=t.sync,v=t.responseType;!function(e){var t=e.url,n=e.params,a=void 0===n?{}:n,c=e.success,u=void 0===c?o:c,h=e.error,l=void 0===h?o:h,f=e.before,d=void 0===f?o:f,g=e.after,v=void 0===g?o:g,m=e.headers,y=void 0===m?{}:m,p=e.sync,w=void 0!==p&&p,b=e.timeout,x=void 0===b?0:b,C=e.responseType,S=void 0===C?"json":C,k=e.method.toUpperCase(),T=new XMLHttpRequest;d();var O=t,j=null;if("GET"===k){for(var E=[],L=0,R=Object.keys(a);L<R.length;L++){var B=R[L],H=a[B];"function"==typeof H&&(H=H()),null!=H&&H==H&&H!==1/0&&H!==-1/0||(H=""),"object"==typeof H&&(H=JSON.stringify(H)),E.push(B+"="+encodeURIComponent(H))}E.length&&(O+=(-1===O.indexOf("?")?"?":"&")+E.join("&"))}T.open(k,O,!w),T.onreadystatechange=function(){if(4===T.readyState)if(200===T.status){v();var e=T.response;if("json"===S)try{e=JSON.parse(e)}catch(e){console.warn(e)}u(e)}else v(),l(T.statusText)};for(var N=!1,W=!1,I=0,A=Object.keys(y);I<A.length;I++){var D=A[I],q=y[D];if("content-type"===D.toLowerCase()){if(D!==r)continue;if(W=!0,q===i)N=!0;else if(q===s)continue}T.setRequestHeader(D,q)}T.setRequestHeader("x-requested-with","XMLHttpRequest"),"GET"!==k&&(W||(T.setRequestHeader(r,i),N=!0),j=N?JSON.stringify(a):a),w||(T.timeout=x),T.send(j)}({url:n,method:e,params:a,before:c,after:u,success:h,error:l,headers:f,timeout:d,sync:g,responseType:v})}},u=0,h=["get","post","delete","put"];u<h.length;u++)c();a.upload=function(e){var t,n=e.url,o=e.params,i=e.before,c=e.after,u=e.success,h=e.error,l=e.headers,f=void 0===l?{}:l,d=e.timeout,g=e.sync,v=e.responseType;a.post({url:n,params:o,before:i,after:c,success:u,error:h,headers:Object.assign(f,(t={},t[r]=s,t)),timeout:d,sync:g,responseType:v})};const l=a;function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var d=WebSocket.CONNECTING,g=WebSocket.OPEN,v=WebSocket.CLOSING,m=WebSocket.CLOSED,y=Symbol("initWebsocketEvent"),p=Symbol("clearTimer"),w=Symbol("doRetry"),b=Symbol("doHeartCheck"),x=function(){};const C={doready:function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)},ajax:l,WS:function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.ws=null,this.wsState=m,this.timer=null,this.retryConfig={count:0,interval:5e3,tried:0},this.heartBeatConfig={doCheck:!1,timeout:null,message:null,timeoutObj:null,serverTimeoutObj:null},this.listener={onopen:x,onmessage:x,onerror:x,onclose:x}}var t,n;return t=e,(n=[{key:p,value:function(){clearInterval(this.timer),this.timer=null}},{key:y,value:function(){var e=this;this.ws.onopen=function(t){e.retryConfig.tried=0,e.wsState=g,e.listener.onopen(t),e.heartBeatConfig.doCheck&&e[b]().start()},this.ws.onmessage=function(t){e.listener.onmessage(t),e.heartBeatConfig.doCheck&&e[b]().reset().start()},this.ws.onerror=this.listener.onerror,this.ws.onclose=function(t){e.wsState=m,e[p](),e.ws=null,e.listener.onclose(t),e.heartBeatConfig.doCheck&&e[b]().reset(),0!==e.retryConfig.count&&1e3!==t.code&&e[w]()}}},{key:w,value:function(){var e=this.retryConfig,t=e.count,n=e.interval,o=e.tried;t?this.wsState!==WebSocket.OPEN&&o<t-1?(this.reconnect(n),this.retryConfig.tried+=1):this.retryConfig.tried=0:this.reconnect(n)}},{key:b,value:function(){var e=this,t=this.heartBeatConfig,n=t.timeout,o=t.message;return{reset:function(){return clearTimeout(e.heartBeatConfig.timeoutObj),clearTimeout(e.heartBeatConfig.serverTimeoutObj),this},start:function(){e.heartBeatConfig.timeoutObj=setTimeout((function(){e.send(o),e.heartBeatConfig.serverTimeoutObj=setTimeout((function(){e.disconnect(4e3,"Loss connection")}),1e4)}),n)}}}},{key:"subscribe",value:function(e){return"function"==typeof e?this.listener.onmessage=e:this.listener=Object.assign(this.listener,e),this}},{key:"connect",value:function(){try{if(this.wsState!==m)throw new Error("Connection is busy, please try again later.");return this.wsState=d,this.ws=new WebSocket(this.url),this[y](),this}catch(e){this.wsState=m}}},{key:"disconnect",value:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t="Normal closure"),e&&1e3===!e||e>=4999&&e<=3e3)throw new Error("Invalid code");if(null===this.ws||this.wsState!==g)throw new Error("Connection has already been closed");this.wsState=v,this.retryConfig.tried=0,this.ws.close(e,t,!0)}},{key:"reconnect",value:function(e){var t=this;void 0===e&&(e=5e3),void 0===this.timer&&null===this.timer||this[p](),this.timer=setInterval((function(){t.wsState===m&&t.connect()}),e)}},{key:"retry",value:function(e,t){if(void 0===t&&(t=5e3),e<0)throw new Error("Retry count must not be less than 0");return this.retryConfig=Object.assign(this.retryConfig,{count:e,interval:t}),this}},{key:"heartBeat",value:function(e,t){return void 0===e&&(e=3e4),void 0===t&&(t={command:"ping"}),this.heartBeatConfig={doCheck:!0,timeout:e,message:t},this}},{key:"send",value:function(e){if(this.readyState===d)throw new Error("The connection has not been established yet");this.readyState===g&&("object"==typeof e&&(e=JSON.stringify(e)),this.ws.send(e))}},{key:"readyState",get:function(){return this.wsState}}])&&f(t.prototype,n),e}(),uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}},S="https://tracker.insstoreweb.com/api/track",k="wss://tracker.insstoreweb.com/api/track",T={getInfo:function(){return{userAgent:this.getUserAgent(),colorDepth:this.getColorDepth(),currentResolution:this.getCurrentResolution(),availableResolution:this.getAvailableResolution(),timeZone:this.getTimeZone(),language:this.getLanguage(),systemLanguage:this.getSystemLanguage(),url:top.location.href,height:screen.height,width:screen.width}},getUserAgent:function(){return navigator.userAgent},getColorDepth:function(){return screen.colorDepth},getCurrentResolution:function(){return screen.width+"x"+screen.height},getAvailableResolution:function(){return screen.availWidth+"x"+screen.availHeight},getTimeZone:function(){var e,t;return e=new Date,(t=String(-e.getTimezoneOffset()/60))<0?"-"+("0"+(t*=-1)).slice(-2):"+"+("0"+t).slice(-2)},getLanguage:function(){return navigator.language},getSystemLanguage:function(){return navigator.systemLanguage||window.navigator.language}},O=function(e){var t=T.getInfo(),n={url:S+"/get-id",params:t,success:function(t){e&&e(t)},error:function(){console.log("error")}};C.ajax.post(n)};function j(){void 0!==this&&(this.startedAt=0,this.recording=!1,this.recordCallback=null,this.window={width:window.outerWidth,height:window.outerHeight},this.doc=top.document)}j.prototype={record:function(e){if(!this.recording){e&&(this.recordCallback=e);var t=this;t.startedAt=(new Date).getTime()/1e3,this.doc.addEventListener("touchstart",(function(e){t.ontouchstart(e)})),this.doc.addEventListener("touchmove",(function(e){t.ontouchmove(e)})),this.doc.addEventListener("touchend",(function(e){t.ontouchend(e)})),t.recording=!0}},commit:function(e){var t=e.concat((new Date).getTime()-1e3*this.startedAt);this.recordCallback&&this.recordCallback(t)},ontouchstart:function(e){if(e.targetTouches&&e.targetTouches.length>0){var t=e.targetTouches[0],n=["touchstart",t.screenX,t.screenY];this.commit(n)}},ontouchmove:function(e){if(e.targetTouches&&e.targetTouches.length>0){var t=e.targetTouches[0],n=["touchmove",t.screenX,t.screenY];this.commit(n)}},ontouchend:function(e){if(e.changedTouches&&e.changedTouches.length>0){var t=e.changedTouches[0],n=["touchend",t.screenX,t.screenY];this.commit(n)}}};const E=j,L=function(e,t){var n=k+"/ws?sessionId="+e,o=new C.WS(n);return o.subscribe({onopen:function(){t&&t()},onerror:function(){console.log("onerror")},onclose:function(){console.log("onclose")}}),o.connect(),o},R=function(e){var t=L(e,(function(){(new E).record((function(n){var o={sessionId:e,height:screen.height,width:screen.width};o.event=n[0],o.x=Math.floor(n[1]),o.y=Math.floor(n[2]),o.time=n[3],t.send(o)}))}))},B={start:function(){C.doready((function(){O((function(e){0==e.code&&e.data.wsid&&R(e.data.wsid)}))}))}}}},t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}return n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(70)})().default}));
//# sourceMappingURL=Hotflow.min.js.map