!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Hotflow",[],t):"object"==typeof exports?exports.Hotflow=t():e.Hotflow=t()}("undefined"!=typeof self?self:this,(function(){return(()=>{"use strict";var e={354:(e,t,n)=>{n.d(t,{default:()=>E});for(var i=function(){},o="Content-Type",s="application/json",r="multipart/form-data",a=Object.create(null),c=function(){var e=l[u];a[e]=function(t){var n=t.url,a=t.params,c=t.before,u=t.after,l=t.success,d=t.error,h=t.headers,f=t.timeout,m=t.sync,w=t.responseType;!function(e){var t=e.url,n=e.params,a=void 0===n?{}:n,c=e.success,u=void 0===c?i:c,l=e.error,d=void 0===l?i:l,h=e.before,f=void 0===h?i:h,m=e.after,w=void 0===m?i:m,p=e.headers,y=void 0===p?{}:p,g=e.sync,v=void 0!==g&&g,b=e.timeout,S=void 0===b?0:b,x=e.responseType,C=void 0===x?"json":x,I=e.method.toUpperCase(),k=new XMLHttpRequest;f();var j=t,T=null;if("GET"===I){for(var M=[],L=0,E=Object.keys(a);L<E.length;L++){var O=E[L],B=a[O];"function"==typeof B&&(B=B()),null!=B&&B==B&&B!==1/0&&B!==-1/0||(B=""),"object"==typeof B&&(B=JSON.stringify(B)),M.push(O+"="+encodeURIComponent(B))}M.length&&(j+=(-1===j.indexOf("?")?"?":"&")+M.join("&"))}k.open(I,j,!v),k.onreadystatechange=function(){if(4===k.readyState)if(200===k.status){w();var e=k.response;if("json"===C)try{e=JSON.parse(e)}catch(e){console.warn(e)}u(e)}else w(),d(k.statusText)};for(var N=!1,P=!1,A=0,D=Object.keys(y);A<D.length;A++){var W=D[A],H=y[W];if("content-type"===W.toLowerCase()){if(W!==o)continue;if(P=!0,H===s)N=!0;else if(H===r)continue}k.setRequestHeader(W,H)}k.setRequestHeader("x-requested-with","XMLHttpRequest"),"GET"!==I&&(P||(k.setRequestHeader(o,s),N=!0),T=N?JSON.stringify(a):a),v||(k.timeout=S),k.send(T)}({url:n,method:e,params:a,before:c,after:u,success:l,error:d,headers:h,timeout:f,sync:m,responseType:w})}},u=0,l=["get","post","delete","put"];u<l.length;u++)c();a.upload=function(e){var t,n=e.url,i=e.params,s=e.before,c=e.after,u=e.success,l=e.error,d=e.headers,h=void 0===d?{}:d,f=e.timeout,m=e.sync,w=e.responseType;a.post({url:n,params:i,before:s,after:c,success:u,error:l,headers:Object.assign(h,(t={},t[o]=r,t)),timeout:f,sync:m,responseType:w})};const d=a;function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var f=WebSocket.CONNECTING,m=WebSocket.OPEN,w=WebSocket.CLOSING,p=WebSocket.CLOSED,y=Symbol("initWebsocketEvent"),g=Symbol("clearTimer"),v=Symbol("doRetry"),b=Symbol("doHeartCheck"),S=function(){};const x={doready:function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)},ajax:d,WS:function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.ws=null,this.wsState=p,this.timer=null,this.retryConfig={count:0,interval:5e3,tried:0},this.heartBeatConfig={doCheck:!1,timeout:null,message:null,timeoutObj:null,serverTimeoutObj:null},this.listener={onopen:S,onmessage:S,onerror:S,onclose:S}}var t,n;return t=e,(n=[{key:g,value:function(){clearInterval(this.timer),this.timer=null}},{key:y,value:function(){var e=this;this.ws.onopen=function(t){e.retryConfig.tried=0,e.wsState=m,e.listener.onopen(t),e.heartBeatConfig.doCheck&&e[b]().start()},this.ws.onmessage=function(t){e.listener.onmessage(t),e.heartBeatConfig.doCheck&&e[b]().reset().start()},this.ws.onerror=this.listener.onerror,this.ws.onclose=function(t){e.wsState=p,e[g](),e.ws=null,e.listener.onclose(t),e.heartBeatConfig.doCheck&&e[b]().reset(),0!==e.retryConfig.count&&1e3!==t.code&&e[v]()}}},{key:v,value:function(){var e=this.retryConfig,t=e.count,n=e.interval,i=e.tried;t?this.wsState!==WebSocket.OPEN&&i<t-1?(this.reconnect(n),this.retryConfig.tried+=1):this.retryConfig.tried=0:this.reconnect(n)}},{key:b,value:function(){var e=this,t=this.heartBeatConfig,n=t.timeout,i=t.message;return{reset:function(){return clearTimeout(e.heartBeatConfig.timeoutObj),clearTimeout(e.heartBeatConfig.serverTimeoutObj),this},start:function(){e.heartBeatConfig.timeoutObj=setTimeout((function(){e.send(i),e.heartBeatConfig.serverTimeoutObj=setTimeout((function(){e.disconnect(4e3,"Loss connection")}),1e4)}),n)}}}},{key:"subscribe",value:function(e){return"function"==typeof e?this.listener.onmessage=e:this.listener=Object.assign(this.listener,e),this}},{key:"connect",value:function(){try{if(this.wsState!==p)throw new Error("Connection is busy, please try again later.");return this.wsState=f,this.ws=new WebSocket(this.url),this[y](),this}catch(e){this.wsState=p}}},{key:"disconnect",value:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t="Normal closure"),e&&1e3===!e||e>=4999&&e<=3e3)throw new Error("Invalid code");if(null===this.ws||this.wsState!==m)throw new Error("Connection has already been closed");this.wsState=w,this.retryConfig.tried=0,this.ws.close(e,t,!0)}},{key:"reconnect",value:function(e){var t=this;void 0===e&&(e=5e3),void 0===this.timer&&null===this.timer||this[g](),this.timer=setInterval((function(){t.wsState===p&&t.connect()}),e)}},{key:"retry",value:function(e,t){if(void 0===t&&(t=5e3),e<0)throw new Error("Retry count must not be less than 0");return this.retryConfig=Object.assign(this.retryConfig,{count:e,interval:t}),this}},{key:"heartBeat",value:function(e,t){return void 0===e&&(e=3e4),void 0===t&&(t={command:"ping"}),this.heartBeatConfig={doCheck:!0,timeout:e,message:t},this}},{key:"send",value:function(e){if(this.readyState===f)throw new Error("The connection has not been established yet");this.readyState===m&&("object"==typeof e&&(e=JSON.stringify(e)),this.ws.send(e))}},{key:"readyState",get:function(){return this.wsState}}])&&h(t.prototype,n),e}(),uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}},C="https://tracker.insstoreweb.com/api/track",I="wss://tracker.insstoreweb.com/api/track",k=function(e){var t=(new XMLSerializer).serializeToString(document),n={url:C+"/get-id",params:{url:top.location.href,height:top.innerHeight,width:top.innerWidth,content:t,userAgent:top.navigator.userAgent},success:function(t){e&&e(t)},error:function(){console.log("error")}};x.ajax.post(n)};function j(){void 0!==this?(this.frames=[],this.timeouts=[],this.pos=0,this.currPos=0,this.startedAt=0,this.finishedAt=0,this.timePoint=!1,this.recording=!1,this.playing=!1,this.playbackSpeed=this.speed.NORMAL,this.window={width:window.outerWidth,height:window.outerHeight},this.onmousemove=window.onmousemove,this.onmousedown=window.onmousedown,this.onscroll=window.onscroll):console.error('Have you initialized Behaviour with "new" statement? (i.e. var mus = new Behaviour())')}j.prototype={moveListener:function(e){return function(t){e&&e(["m",t.clientX,t.clientY])}},clickListener:function(e){return function(t){e&&e(["c",t.clientX,t.clientY])}},scrollListener:function(e){return function(t){e&&e(["s",document.scrollingElement.scrollLeft,document.scrollingElement.scrollTop])}},record:function(e){if(!this.recording){var t=this;t.startedAt=(new Date).getTime()/1e3,t.frames.push(["s",document.scrollingElement.scrollLeft,document.scrollingElement.scrollTop]),window.onmousemove=this.moveListener((function(n){var i=t.timePoint?n.concat((new Date).getTime()-1e3*t.startedAt):n;t.frames.push(i),e instanceof Function&&e(i)})),window.onmousedown=this.clickListener((function(n){var i=t.timePoint?n.concat((new Date).getTime()-1e3*t.startedAt):n;t.frames.push(i),e instanceof Function&&e(i)})),window.onscroll=this.scrollListener((function(n){var i=t.timePoint?n.concat((new Date).getTime()-1e3*t.startedAt):n;t.frames.push(i),e instanceof Function&&e(i)})),t.recording=!0}},stop:function(){this.finishedAt=(new Date).getTime()/1e3,window.onmousemove=this.onmousemove,window.onmousedown=this.onmousedown,window.onscroll=this.onscroll,this.timeouts=[],this.recording=!1,this.playing=!1,this.pos=0},pause:function(){this.playing&&(this.pos=this.currPos,this.playing=!1,this.clearTimeouts())},play:function(e){if(!this.playing){var t=this;t.createCursor();for(var n=document.getElementById("musCursor");t.pos<t.frames.length;t.pos++){var i=t.frames[t.pos].length>3?t.frames[t.pos][3]:t.pos*t.playbackSpeed;t.timeouts.push(setTimeout((function(i){t.playFrame(t,t.frames[i],n),t.currPos=i,i==t.frames.length-1&&(n.style.backgroundColor="transparent",t.timeouts=[],t.playing=!1,t.pos=0,e&&e())}),i,t.pos))}this.playing=!0}},release:function(){this.frames=[],this.startedAt=0,this.finishedAt=0,this.stop(),this.destroyCursor(),this.destroyClickSnapshot()},playFrame:function(e,t,n){"m"==t[0]?(n.style.left=e.getXCoordinate(t[1])+"px",n.style.top=e.getYCoordinate(t[2])+"px"):"c"==t[0]?e.createClickSnapshot(t[2],t[1]):"s"==t[0]&&window.scrollTo(t[1],t[2])},clearTimeouts:function(){for(var e in this.timeouts)clearTimeout(this.timeouts[e]);this.timeouts=[]},timeElapsed:function(){return this.finishedAt-this.startedAt},createCursor:function(){if(!document.getElementById("musCursor")){var e=document.createElement("div");e.id="musCursor",e.style.position="fixed",e.style.width="32px",e.style.height="32px",e.style.top="-100%",e.style.left="-100%",e.style.borderRadius="32px",e.style.backgroundImage="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCSB2aWV3Qm94PSIwIDAgMjggMjgiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI4IDI4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cG9seWdvbiBmaWxsPSIjRkZGRkZGIiBwb2ludHM9IjguMiwyMC45IDguMiw0LjkgMTkuOCwxNi41IDEzLDE2LjUgMTIuNiwxNi42ICIvPjxwb2x5Z29uIGZpbGw9IiNGRkZGRkYiIHBvaW50cz0iMTcuMywyMS42IDEzLjcsMjMuMSA5LDEyIDEyLjcsMTAuNSAiLz48cmVjdCB4PSIxMi41IiB5PSIxMy42IiB0cmFuc2Zvcm09Im1hdHJpeCgwLjkyMjEgLTAuMzg3MSAwLjM4NzEgMC45MjIxIC01Ljc2MDUgNi41OTA5KSIgd2lkdGg9IjIiIGhlaWdodD0iOCIvPjxwb2x5Z29uIHBvaW50cz0iOS4yLDcuMyA5LjIsMTguNSAxMi4yLDE1LjYgMTIuNiwxNS41IDE3LjQsMTUuNSAiLz48L3N2Zz4=)",document.body.appendChild(e)}},destroyCursor:function(){var e=document.getElementById("musCursor");e&&e.remove()},createClickSnapshot:function(e,t){var n=document.scrollingElement.scrollLeft,i=document.scrollingElement.scrollTop,o=document.createElement("div");o.className="musClickSnapshot",o.style.position="absolute",o.style.width="32px",o.style.height="32px",o.style.top=e+i+"px",o.style.left=t+n+"px",o.style.borderRadius="32px",o.style.backgroundColor="red",o.style.opacity=.2,document.body.appendChild(o)},destroyClickSnapshot:function(){for(var e=document.getElementsByClassName("musClickSnapshot");e.length>0;)e[0].remove()},getXCoordinate:function(e){return window.outerWidth>this.window.width?parseInt(this.window.width*e/window.outerWidth):parseInt(window.outerWidth*e/this.window.width)},getYCoordinate:function(e){return window.outerHeight>this.window.height?parseInt(this.window.height*e/window.outerHeight):parseInt(window.outerHeight*e/this.window.height)},getData:function(){return{frames:this.frames,timeElapsed:this.timeElapsed(),window:{width:window.outerWidth,height:window.outerHeight}}},isTimePoint:function(){return this.timePoint},setData:function(e){var t;if(t=e.length,"{"==e.substring(0,1)&&"}"==e.substring(t-1,t)&&null!==e.substring(1,t-1).match(/(\"frames\":){1}([[,"smc\d\s\]])+[^}]*((\"window\":{[^}]){1})*}?/)){var n=JSON.parse(e);n.frames&&(this.frames=n.frames),n.window&&(this.window=n.window)}},setFrames:function(e){this.frames=e},setWindowSize:function(e,t){this.window.width=e,this.window.height=t},setPlaybackSpeed:function(e){this.playbackSpeed=e},setTimePoint:function(e){this.timePoint=e},isRecording:function(){return this.recording},isPlaying:function(){return this.playing},speed:{SLOW:35,NORMAL:15,FAST:5}};const T=j,M=function(e,t){var n=I+"/ws?sessionId="+e,i=new x.WS(n);return i.subscribe({onopen:function(){t&&t()},onerror:function(){console.log("onerror")},onclose:function(){console.log("onclose")}}),i.connect(),i},L=function(e){var t=M(e,(function(){var n=new T;n.setTimePoint(!0),n.record((function(n){var i={sessionId:e,data:n};t.send(i),console.log(JSON.stringify(i))}))}))},E={start:function(){x.doready((function(){k((function(e){0==e.code&&e.data.wsid&&L(e.data.wsid)}))}))}}}},t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}return n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(354)})().default}));
//# sourceMappingURL=Hotflow.min.js.map