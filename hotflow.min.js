/*! For license information please see Hotflow.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Hotflow",[],t):"object"==typeof exports?exports.Hotflow=t():e.Hotflow=t()}("undefined"!=typeof self?self:this,(function(){return(()=>{"use strict";var e={21:(e,t,o)=>{o.d(t,{default:()=>L});for(var n=function(){},r="Content-Type",i="application/json",s="multipart/form-data",a=Object.create(null),c=function(){var e=h[u];a[e]=function(t){var o=t.url,a=t.params,c=t.before,u=t.after,h=t.success,f=t.error,d=t.headers,l=t.timeout,m=t.sync,v=t.responseType;!function(e){var t=e.url,o=e.params,a=void 0===o?{}:o,c=e.success,u=void 0===c?n:c,h=e.error,f=void 0===h?n:h,d=e.before,l=void 0===d?n:d,m=e.after,v=void 0===m?n:m,p=e.headers,y=void 0===p?{}:p,g=e.sync,w=void 0!==g&&g,b=e.timeout,x=void 0===b?0:b,C=e.responseType,S=void 0===C?"json":C,k=e.method.toUpperCase(),T=new XMLHttpRequest;l();var O=t,j=null;if("GET"===k){for(var E=[],H=0,L=Object.keys(a);H<L.length;H++){var W=L[H],B=a[W];"function"==typeof B&&(B=B()),null!=B&&B==B&&B!==1/0&&B!==-1/0||(B=""),"object"==typeof B&&(B=JSON.stringify(B)),E.push(W+"="+encodeURIComponent(B))}E.length&&(O+=(-1===O.indexOf("?")?"?":"&")+E.join("&"))}T.open(k,O,!w),T.onreadystatechange=function(){if(4===T.readyState)if(200===T.status){v();var e=T.response;if("json"===S)try{e=JSON.parse(e)}catch(e){console.warn(e)}u(e)}else v(),f(T.statusText)};for(var N=!1,I=!1,R=0,M=Object.keys(y);R<M.length;R++){var q=M[R],X=y[q];if("content-type"===q.toLowerCase()){if(q!==r)continue;if(I=!0,X===i)N=!0;else if(X===s)continue}T.setRequestHeader(q,X)}T.setRequestHeader("x-requested-with","XMLHttpRequest"),"GET"!==k&&(I||(T.setRequestHeader(r,i),N=!0),j=N?JSON.stringify(a):a),w||(T.timeout=x),T.send(j)}({url:o,method:e,params:a,before:c,after:u,success:h,error:f,headers:d,timeout:l,sync:m,responseType:v})}},u=0,h=["get","post","delete","put"];u<h.length;u++)c();a.upload=function(e){var t,o=e.url,n=e.params,i=e.before,c=e.after,u=e.success,h=e.error,f=e.headers,d=void 0===f?{}:f,l=e.timeout,m=e.sync,v=e.responseType;a.post({url:o,params:n,before:i,after:c,success:u,error:h,headers:Object.assign(d,(t={},t[r]=s,t)),timeout:l,sync:m,responseType:v})};const f=a;function d(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=WebSocket.CONNECTING,m=WebSocket.OPEN,v=WebSocket.CLOSING,p=WebSocket.CLOSED,y=Symbol("initWebsocketEvent"),g=Symbol("clearTimer"),w=Symbol("doRetry"),b=Symbol("doHeartCheck"),x=function(){};const C={doready:function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)},ajax:f,WS:function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.ws=null,this.wsState=p,this.timer=null,this.retryConfig={count:0,interval:5e3,tried:0},this.heartBeatConfig={doCheck:!1,timeout:null,message:null,timeoutObj:null,serverTimeoutObj:null},this.listener={onopen:x,onmessage:x,onerror:x,onclose:x}}var t,o;return t=e,(o=[{key:g,value:function(){clearInterval(this.timer),this.timer=null}},{key:y,value:function(){var e=this;this.ws.onopen=function(t){e.retryConfig.tried=0,e.wsState=m,e.listener.onopen(t),e.heartBeatConfig.doCheck&&e[b]().start()},this.ws.onmessage=function(t){e.listener.onmessage(t),e.heartBeatConfig.doCheck&&e[b]().reset().start()},this.ws.onerror=this.listener.onerror,this.ws.onclose=function(t){e.wsState=p,e[g](),e.ws=null,e.listener.onclose(t),e.heartBeatConfig.doCheck&&e[b]().reset(),0!==e.retryConfig.count&&1e3!==t.code&&e[w]()}}},{key:w,value:function(){var e=this.retryConfig,t=e.count,o=e.interval,n=e.tried;t?this.wsState!==WebSocket.OPEN&&n<t-1?(this.reconnect(o),this.retryConfig.tried+=1):this.retryConfig.tried=0:this.reconnect(o)}},{key:b,value:function(){var e=this,t=this.heartBeatConfig,o=t.timeout,n=t.message;return{reset:function(){return clearTimeout(e.heartBeatConfig.timeoutObj),clearTimeout(e.heartBeatConfig.serverTimeoutObj),this},start:function(){e.heartBeatConfig.timeoutObj=setTimeout((function(){e.send(n),e.heartBeatConfig.serverTimeoutObj=setTimeout((function(){e.disconnect(4e3,"Loss connection")}),1e4)}),o)}}}},{key:"subscribe",value:function(e){return"function"==typeof e?this.listener.onmessage=e:this.listener=Object.assign(this.listener,e),this}},{key:"connect",value:function(){try{if(this.wsState!==p)throw new Error("Connection is busy, please try again later.");return this.wsState=l,this.ws=new WebSocket(this.url),this[y](),this}catch(e){this.wsState=p}}},{key:"disconnect",value:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t="Normal closure"),e&&1e3===!e||e>=4999&&e<=3e3)throw new Error("Invalid code");if(null===this.ws||this.wsState!==m)throw new Error("Connection has already been closed");this.wsState=v,this.retryConfig.tried=0,this.ws.close(e,t,!0)}},{key:"reconnect",value:function(e){var t=this;void 0===e&&(e=5e3),void 0===this.timer&&null===this.timer||this[g](),this.timer=setInterval((function(){t.wsState===p&&t.connect()}),e)}},{key:"retry",value:function(e,t){if(void 0===t&&(t=5e3),e<0)throw new Error("Retry count must not be less than 0");return this.retryConfig=Object.assign(this.retryConfig,{count:e,interval:t}),this}},{key:"heartBeat",value:function(e,t){return void 0===e&&(e=3e4),void 0===t&&(t={command:"ping"}),this.heartBeatConfig={doCheck:!0,timeout:e,message:t},this}},{key:"send",value:function(e){if(this.readyState===l)throw new Error("The connection has not been established yet");this.readyState===m&&("object"==typeof e&&(e=JSON.stringify(e)),this.ws.send(e))}},{key:"readyState",get:function(){return this.wsState}}])&&d(t.prototype,o),e}(),uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}},S="https://tracker.insstoreweb.com/api/track",k="wss://tracker.insstoreweb.com/api/track",T=function(e){(new XMLSerializer).serializeToString(document);var t={url:S+"/get-id",params:{url:top.location.href,height:top.innerHeight,width:top.innerWidth,userAgent:top.navigator.userAgent},success:function(t){e&&e(t)},error:function(){console.log("error")}};C.ajax.post(t)};function O(){void 0!==this&&(this.startedAt=0,this.recording=!1,this.recordCallback=null,this.window={width:window.outerWidth,height:window.outerHeight},this.doc=top.document)}O.prototype={record:function(e){if(!this.recording){e&&(this.recordCallback=e);var t=this;t.startedAt=(new Date).getTime()/1e3,this.doc.addEventListener("touchstart",(function(e){t.ontouchstart(e)})),this.doc.addEventListener("touchmove",(function(e){t.ontouchmove(e)})),this.doc.addEventListener("touchend",(function(e){t.ontouchend(e)})),t.recording=!0}},commit:function(e){var t=e.concat((new Date).getTime()-1e3*this.startedAt);this.recordCallback&&this.recordCallback(t)},ontouchstart:function(e){if(e.targetTouches&&e.targetTouches.length>0){var t=e.targetTouches[0],o=["touchstart",t.screenX,t.screenY];this.commit(o)}},ontouchmove:function(e){if(e.targetTouches&&e.targetTouches.length>0){var t=e.targetTouches[0],o=["touchmove",t.screenX,t.screenY];this.commit(o)}},ontouchend:function(e){if(e.changedTouches&&e.changedTouches.length>0){var t=e.changedTouches[0],o=["touchend",t.screenX,t.screenY];this.commit(o)}}};const j=O,E=function(e,t){var o=k+"/ws?sessionId="+e,n=new C.WS(o);return n.subscribe({onopen:function(){t&&t()},onerror:function(){console.log("onerror")},onclose:function(){console.log("onclose")}}),n.connect(),n},H=function(e){var t=E(e,(function(){(new j).record((function(o){var n={sessionId:e,height:top.innerHeight,width:top.innerWidth};n.event=o[0],n.x=Math.floor(o[1]),n.y=Math.floor(o[2]),n.time=o[3],t.send(n)}))}))},L={start:function(){C.doready((function(){T((function(e){0==e.code&&e.data.wsid&&H(e.data.wsid)}))}))}}}},t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}return o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o(21)})().default}));
//# sourceMappingURL=Hotflow.min.js.map